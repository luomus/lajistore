# Luomus

This project is Luomus monorepo for managing projects used by Luomus.
Currently, these are:
* Kotka collection management system v3
* Store storage api v2

This workspace uses [Nx](https://nx.dev) to manage the workspace
and [Docker](https://www.docker.com/) to run applications.

## Tech Stack & Links to Documentations

> [Docker](https://docs.docker.com/)

> [Angular](https://angular.io/docs)

> [NestJS](https://docs.nestjs.com/)

> [RabbitMQ](https://www.rabbitmq.com/documentation.html)

> [Nx](https://nx.dev/angular)

> [ElasticSearch](https://www.elastic.co/guide/en/elasticsearch/reference/current/index.html)

> [PostgreSQL](https://www.postgresql.org/docs/) (other database can be used as long as [TypeORM](https://typeorm.io/) supports transactions on them)

## Development server

Run `docker-compose up` for a dev server.
Navigate to http://localhost:4200/ for Kotka and to http://localhost:3000/ for Store.
The app will automatically reload if you change any of the source files.

## Shared resources

There are common resources that are generated by the store cli generate commands.
Models change quite often so there is helper script that you can run to generate these:
```shell
# for local env
./tools/scripts/update-common.sh

# for staging env (you also need .env.staging)
./tools/scripts/update-common.sh staging

# for production env (you also need .env.production)
./tools/scripts/update-common.sh production
```

## Store deployment

There are two helper script to publish changes to staging and to production.
```shell
# for staging (you also need .env.staging and *.staging.yaml files in kubernetes folder)
./tools/scripts/deploy-store-staging.sh

# for production (you also need .env.staging and *.production.yaml files in kubernetes folder)
./tools/scripts/deploy-store-production.sh
```

## Generate an application

Run `ng g @nrwl/angular:app my-app` to generate an application.

> You can use any of the plugins provided by Nx to generate applications as well.

## Generate a library

Run `ng g @nrwl/angular:lib my-lib` to generate a library.

> You can also use any of the provided by Nx above to generate libraries as well.

Libraries are sharable across libraries and applications. They can be imported from `@luomus/mylib`.

## Code scaffolding

Run `ng g component my-component --project=my-app` to generate a new component.

## Running unit tests

Run `ng test my-app` to execute the unit tests via [Jest](https://jestjs.io).

Run `nx affected:test` to execute the unit tests affected by a change.

## Running end-to-end tests

Run `ng e2e my-app` to execute the end-to-end tests via [Cypress](https://www.cypress.io).

Run `nx affected:e2e` to execute the end-to-end tests affected by a change.

For Store e2e tests you can run `./tools/scripts/test-store.sh`.
You need the `.env.e2e` file in the root of the repo.

## Understand your workspace

Run `nx dep-graph` to see a diagram of the dependencies of your projects.

## Further help

Visit the [FinBIF foorums](https://foorumi.laji.fi/) to connect with other users and us or
contact us using the contact information in the [FinBIF web site](https://species.fi).

## ‚òÅ KotkaCMS Cloud

If you would like to give Kotka a spin you can get in touch with us, 
and we'll set up a private demo for you to give KotkaCMS try.
